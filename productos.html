<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mixly - Productos</title>

    <style>
        * {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: radial-gradient(circle at top, #200, #000);
    color: #eee;
    overflow-x: hidden; /* <- evita barras horizontales feas */
}

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: radial-gradient(circle at top, #200, #000);
            color: #eee;
        }

        .container {
            width: 95%;
            max-width: 1100px;
            margin: auto;
            padding: 40px 0;
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: #ff4d6d;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,50,50,0.3);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(4px);
            margin-bottom: 30px;
        }

        label {
            font-weight: 600;
            color: #ffb5b5;
            display: block;
            margin-bottom: 5px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            margin-bottom: 15px;
            outline: none;
            transition: 0.2s;
            font-size: 15px;
        }

        input:focus, select:focus {
            border-color: #ff4d6d;
        }

        button {
            padding: 12px 20px;
            background: #ff4d6d;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: 0.15s;
        }

        button:hover {
            background: #ff1e4d;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        th {
            color: #ff7a7a;
            font-size: 14px;
            text-transform: uppercase;
        }

        .row-actions button {
            margin-right: 5px;
            padding: 6px 12px;
            font-size: 13px;
        }

        .delete-btn {
            background: #e63946;
        }
        .delete-btn:hover {
            background: #c1121f;
        }

        .edit-btn {
            background: #457b9d;
        }
        .edit-btn:hover {
            background: #1d3557;
        }
        .form-section, .table-section {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.06);
    padding: 25px;
    margin: 30px auto;
    width: 90%;
    border-radius: 12px;
}

label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
    color: #f3f3f3;
}

input, select {
    width: 100%;
    margin-top: 5px;
    padding: 12px;
    border-radius: 8px;
    background: #111;
    border: 1px solid #444;
    color: white;
}

button {
    margin-top: 20px;
    padding: 12px 20px;
    background: #ff4d5a;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
}

button.edit-btn {
    background: #2b8cff;
}

button.delete-btn {
    background: #ff2a3c;
}

table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
    color: white;
}

th, td {
    padding: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    text-align: left;
}

th {
    color: #ff4d5a;
    font-weight: 700;
}

    </style>
</head>
<body>

<div class="container">

    <h1>Productos</h1>

    <!-- ==========================
         FORMULARIO AGREGAR PRODUCTO
    ============================ -->
    <div class="card">
        <h2 style="margin-top:0;color:#ff7a7a;">Agregar nuevo producto</h2>

        <label>Nombre del producto</label>
        <input type="text" id="productName" placeholder="Ej: Gin, LimÃ³n, Jarabe..." />

        <label>CategorÃ­a</label>
        <select id="productCategory">
            <option value="">Seleccionar categorÃ­aâ€¦</option>
            <option value="Licor">Licor</option>
            <option value="Fruta">Fruta</option>
            <option value="Insumo">Insumo</option>
            <option value="Base">Base</option>
        </select>

       <label>Cantidad total (ml / gr)</label>
<input type="number" id="productCantidad" placeholder="Ej: 750" min="1" />

<label>Precio total del producto</label>
<input type="number" id="productPrecioTotal" placeholder="Ej: 10000" min="1" />


        <label>Unidad</label>
        <select id="productUnit">
            <option value="">Seleccionar unidadâ€¦</option>
            <option value="ml">ml</option>
            <option value="gr">gr</option>
        </select>

        <button id="addProductBtn" style="margin-top:10px;">Agregar producto</button>
    </div>


    <!-- ==========================
         LISTA DE PRODUCTOS
    ============================ -->
    <div class="card">
        <h2 style="margin-top:0;color:#ff7a7a;">Listado de productos</h2>

       <table id="productsTable">
    <thead>
        <tr>
            <th>Producto</th>
            <th>CategorÃ­a</th>
            <th>Cantidad total</th>
            <th>Precio total</th>
            <th>Precio / unidad</th>
            <th>Unidad</th>
            <th style="text-align:center;">Acciones</th>
        </tr>
    </thead>
            <tbody>
                <!-- Se llena dinÃ¡micamente -->
            </tbody>
        </table>
    </div>

</div>
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const SUPABASE_URL = "https://hhfpaviwuuqcuhcsfwdj.supabase.co";
const SUPABASE_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhoZnBhdml3dXVxY3VoY3Nmd2RqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNzgwMDgsImV4cCI6MjA3ODg1NDAwOH0.LpccdL9cQqf4vZ5BPqRKnL2Mh5GiLd57pQKujcDHDLg";

const db = createClient(SUPABASE_URL, SUPABASE_KEY);

// ðŸ”¥ SE DECLARAN LOS INPUTS
const nameInput = document.getElementById("productName");
const categoryInput = document.getElementById("productCategory");
const cantidadInput = document.getElementById("productCantidad");
const precioInput = document.getElementById("productPrecioTotal");
const unitInput = document.getElementById("productUnit");
const addBtn = document.getElementById("addProductBtn");

let products = [];
let editingId = null;

window.onload = () => {
    cargarProductos();
    addBtn.addEventListener("click", guardarProducto);
};

async function guardarProducto() {

    const name = nameInput.value.trim();
    const category = categoryInput.value.trim();
    const cantidad_total = parseFloat(cantidadInput.value);
    const precio_total = parseFloat(precioInput.value);
    const unit_type = unitInput.value;

    if (!name || !category || !cantidad_total || !precio_total || !unit_type) {
        alert("Debes completar todos los campos.");
        return;
    }

    const price_per_ml = precio_total / cantidad_total;

    const payload = {
        name,
        category,
        cantidad_total,
        precio_total,
        unit_type,
        price_per_ml
    };

    let result;

    if (editingId) {
        result = await db.from("products").update(payload).eq("id", editingId);
    } else {
        result = await db.from("products").insert([payload]);
    }

    if (result.error) {
        console.error(result.error);
        alert("Error al guardar: " + result.error.message);
        return;
    }

    limpiarInputs();
    editingId = null;
    addBtn.textContent = "Agregar producto";

    cargarProductos();
    if (result.error) {
        console.error("Supabase error:", JSON.stringify(result.error, null, 2));
        alert("Error al guardar: " + result.error.message);
        return;  // â† AQUÃ SÃ ES VÃLIDO
    }
}

async function cargarProductos() {
    const { data, error } = await db
        .from("products")
        .select("*")
        .order("name", { ascending: true });

    if (error) {
        console.error(error);
        return;
    }

    products = data || [];
    renderTabla();
}

function renderTabla() {
    const tbody = document.querySelector("#productsTable tbody");
    tbody.innerHTML = "";

    products.forEach(p => {
        const cantidad = Number(p.cantidad_total);
        const precioTotal = Number(p.precio_total);
        const pricePer = Number(p.price_per_ml);

        tbody.innerHTML += `
            <tr>
                <td>${p.name}</td>
                <td>${p.category}</td>
                <td>${cantidad.toLocaleString("es-CL")}</td>
                <td>$${precioTotal.toLocaleString("es-CL")}</td>
                <td>$${pricePer.toFixed(2)} / ${p.unit_type}</td>
                <td>${p.unit_type}</td>
                <td class="row-actions">
                    <button class="edit-btn" onclick="editProduct(${p.id})">Editar</button>
                    <button class="delete-btn" onclick="deleteProduct(${p.id})">Eliminar</button>
                </td>
            </tr>
        `;
    });
}



window.editProduct = (id) => {
    const p = products.find(x => x.id === id);
    if (!p) return;

    editingId = id;

    nameInput.value = p.name;
    categoryInput.value = p.category;
    cantidadInput.value = p.cantidad_total;
    precioInput.value = p.precio_total;
    unitInput.value = p.unit_type;

    addBtn.textContent = "Guardar cambios";
};

window.deleteProduct = async (id) => {
    if (!confirm("Â¿Eliminar producto?")) return;

    await db.from("products").delete().eq("id", id);
    cargarProductos();
};

function limpiarInputs() {
    nameInput.value = "";
    categoryInput.value = "";
    cantidadInput.value = "";
    precioInput.value = "";
    unitInput.value = "";
}


</script>


</body>
</html>
